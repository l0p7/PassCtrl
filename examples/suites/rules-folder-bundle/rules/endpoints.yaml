endpoints:
  spa-gateway:
    description: "Protects a single-page application by combining session lookup and entitlement checks."
    authentication:
      required: true
      allow: ["header"]
      header: ["x-session-token"]
    forwardProxyPolicy:
      trustedProxyIPs: ["10.0.0.0/8", "192.168.0.0/16"]
      developmentMode: false
    forwardRequestPolicy:
      headers:
        allow: ["x-request-id", "x-session-token"]
        strip: ["cookie"]
        custom:
          x-session-user: "{{ .rule.outputs.user_id }}"
      query:
        allow: ["locale"]
        strip: ["preview"]
        custom:
          tenant: "{{ .rule.outputs.tenant_id }}"
    rules:
      - name: lookup-session
      - name: require-entitlement
    responsePolicy:
      pass:
        status: 200
      fail:
        status: 403
        bodyFile: "deny.json.tmpl"
      error:
        status: 502
        body: |
          {
            "error": "session backend unavailable"
          }
    cache:
      resultTTL: "90s"
